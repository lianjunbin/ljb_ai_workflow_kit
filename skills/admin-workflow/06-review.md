---
description: "代码走读：更新任务状态 + 逐文件走读 + Git 提交建议（仅本次改动，支持多轮迭代）"
---

# /admin:review - 代码走读

执行此命令时，按以下流程输出：

---

## 阶段进度

```
📍 当前进度
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✅ INIT → ✅ START → ✅ API → ✅ BEFORE → ✅ DESIGN → ✅ AUDIT → ✅ APPLY → 🔵 REVIEW → ⚪ ARCHIVE
                                                                                 ↑
                                                                              你在这里
```

---

## 阶段卡片

```
┌─────────────────────────────────────────────────────────────────┐
│  🔍 REVIEW · 代码走读                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📝 这一步做什么？                                               │
│     1. 更新任务状态 - 标记已完成的任务                           │
│     2. 代码走读 - 逐个审阅本次改动的文件，提出优化建议             │
│     3. 选择性修复 - 你来决定哪些建议要采纳                        │
│     4. Git 建议 - 生成提交命令（不自动执行）                      │
│                                                                 │
│  💡 核心原则：                                                   │
│     ⚠️ 只审阅本次改动的文件，绝不动其他代码                      │
│     ⚠️ 基于现有逻辑优化，不过度设计                              │
│     ⚠️ 支持多轮迭代，直到你满意为止                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 执行步骤

### Step 1: 更新任务状态

```
📋 更新任务状态
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  正在读取 tasks.md...

  任务状态更新:
    ✅ Task 1: 添加用户日志 API
    ✅ Task 2: 添加类型定义
    ✅ Task 3: 创建 useUserLog Hook
    ✅ Task 4: 创建 UserLogTable 组件
    ✅ Task 5: 集成到用户详情页

  📊 进度: 5/5 (100%)

  ✅ tasks.md 已更新

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 2: 获取本次改动文件

```
📂 本次改动文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────┬─────────┬──────────┐
  │ 文件                                │ 操作    │ 改动行数 │
  ├─────────────────────────────────────┼─────────┼──────────┤
  │ src/api/user.ts                     │ ✏️ 修改 │ +15      │
  │ src/api/types/user.ts               │ ✏️ 修改 │ +25      │
  │ src/hooks/useUserLog.tsx            │ ➕ 新增 │ +42      │
  │ src/components/user/UserLogTable.vue│ ➕ 新增 │ +68      │
  │ src/views/user/detail.vue           │ ✏️ 修改 │ +35      │
  └─────────────────────────────────────┴─────────┴──────────┘

  📊 统计: 5 个文件，+185 行

  ⚠️ 走读范围仅限以上文件，不会改动其他代码

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 3: 代码走读（逐文件）

```
🔍 开始代码走读
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  [1/5] 📂 src/api/user.ts
  ──────────────────────────────────────────────────────────────

  ✅ 检查通过:
     • 接口定义规范
     • 类型安全

  💡 优化建议 (1):
  ┌──────────────────────────────────────────────────────────┐
  │ 建议 #1: 添加错误处理注释                                │
  │ 位置: 第 18 行                                           │
  │                                                          │
  │ 现有代码:                                                │
  │ export const getUserLogs = (params: GetUserLogsParams) =>│
  │   request.get('/api/v1/user/logs', { params })           │
  │                                                          │
  │ 建议添加:                                                │
  │ // 获取用户操作日志                                       │
  │ // @param params.userId - 用户ID                         │
  │ export const getUserLogs = ...                           │
  │                                                          │
  │ 🏷️ 类型: 【Docs】文档改变                                │
  └──────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────┐
  │ 🤔 如何处理这个建议？                                    │
  │                                                          │
  │    [Y] 采纳，帮我修改                                    │
  │    [N] 跳过，保持现状                                    │
  │    [?] 解释为什么建议这样改                              │
  └──────────────────────────────────────────────────────────┘
```

**如果用户选择 Y：**

```
  ✅ 已应用建议 #1
     📂 src/api/user.ts:18 - 添加了注释

  ────────────────────────────────────────────────────────────

  [2/5] 📂 src/api/types/user.ts
  ────────────────────────────────────────────────────────────

  ✅ 检查通过:
     • 类型定义完整
     • 无冗余代码

  (无建议，继续下一个文件)

  ────────────────────────────────────────────────────────────

  [3/5] 📂 src/hooks/useUserLog.tsx
  ────────────────────────────────────────────────────────────

  ✅ 检查通过:
     • 遵循 Composition API
     • 使用了解构赋值导出

  💡 优化建议 (2):

  ┌──────────────────────────────────────────────────────────┐
  │ 建议 #2: 提取魔法数字为常量                              │
  │ 位置: 第 15 行                                           │
  │                                                          │
  │ 现有代码:                                                │
  │ const pageSize = 20                                      │
  │                                                          │
  │ 建议改为:                                                │
  │ const DEFAULT_PAGE_SIZE = 20                             │
  │ const pageSize = ref(DEFAULT_PAGE_SIZE)                  │
  │                                                          │
  │ 🏷️ 类型: 【Optimize】优化代码                            │
  └──────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────┐
  │ 建议 #3: 简化嵌套条件                                    │
  │ 位置: 第 28-32 行                                        │
  │                                                          │
  │ 现有代码:                                                │
  │ if (res.data) {                                          │
  │   if (res.data.list) {                                   │
  │     logs.value = res.data.list                           │
  │   }                                                      │
  │ }                                                        │
  │                                                          │
  │ 建议改为:                                                │
  │ logs.value = res.data?.list ?? []                        │
  │                                                          │
  │ 🏷️ 类型: 【Optimize】优化代码                            │
  └──────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────┐
  │ 🤔 如何处理这些建议？                                    │
  │                                                          │
  │    [A] 全部采纳                                          │
  │    [2] 只采纳建议 #2                                     │
  │    [3] 只采纳建议 #3                                     │
  │    [N] 全部跳过                                          │
  │    [?] 查看详细说明                                      │
  └──────────────────────────────────────────────────────────┘
```

**继续其他文件...**

```
  ────────────────────────────────────────────────────────────

  [4/5] 📂 src/components/user/UserLogTable.vue
  ────────────────────────────────────────────────────────────

  ✅ 检查通过:
     • 组件结构清晰
     • 使用了 PixTable 组件

  (无建议，继续下一个文件)

  ────────────────────────────────────────────────────────────

  [5/5] 📂 src/views/user/detail.vue
  ────────────────────────────────────────────────────────────

  ✅ 检查通过:
     • Tab 切换逻辑正确
     • 组件引用正确

  (无建议)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 4: 走读总结

```
📊 走读总结
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  审阅文件: 5 个
  发现建议: 3 条
  已采纳:   2 条
  已跳过:   1 条

  应用的修改:
    ✅ src/api/user.ts:18 - 添加注释
    ✅ src/hooks/useUserLog.tsx:28 - 简化嵌套条件

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌──────────────────────────────────────────────────────────────┐
│ 🤔 是否继续走读？                                            │
│                                                              │
│    修改后的代码可能引入新问题，                              │
│    建议再走读一遍确保无误                                    │
│                                                              │
│    [Y] 是，再走读一遍                                        │
│    [N] 不用了，准备提交                                      │
└──────────────────────────────────────────────────────────────┘
```

---

## Step 5: Git 提交建议

```
📝 Git 提交建议
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  根据本次改动，建议使用以下提交方式:

────────────────────────────────────────────────────────────────

📦 提交类型说明
────────────────────────────────────────────────────────────────

  【Feature】 新功能
  【Bugfix】  修复 bug
  【Optimize】优化代码
  【Perf】    性能优化
  【Test】    增加测试
  【Build】   改变构建工具
  【Revert】  撤销上一次 commit
  【Chore】   构建过程或辅助工具变动
  【Docs】    文档改变
  【Style】   样式改变

────────────────────────────────────────────────────────────────

📦 推荐: 单次提交
────────────────────────────────────────────────────────────────

  提交信息:

  【Feature】用户详情页-新增操作日志 Tab

  改动说明:
  - 新增用户操作日志 API 及类型定义
  - 新增 useUserLog hook 封装日志逻辑
  - 新增 UserLogTable 组件展示日志列表
  - 用户详情页添加"操作日志"Tab

────────────────────────────────────────────────────────────────

  📂 涉及文件:

  src/api/user.ts
  src/api/types/user.ts
  src/hooks/useUserLog.tsx
  src/components/user/UserLogTable.vue
  src/views/user/detail.vue

────────────────────────────────────────────────────────────────

  💡 复制以下命令执行:

  ```bash
  git add src/api/user.ts \
          src/api/types/user.ts \
          src/hooks/useUserLog.tsx \
          src/components/user/UserLogTable.vue \
          src/views/user/detail.vue

  git commit -m "【Feature】用户详情页-新增操作日志 Tab

  - 新增用户操作日志 API 及类型定义
  - 新增 useUserLog hook 封装日志逻辑
  - 新增 UserLogTable 组件展示日志列表
  - 用户详情页添加操作日志 Tab"
  ```

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ⚠️ 重要提示
  ┌──────────────────────────────────────────────────────────┐
  │ 系统不会自动执行 Git 命令                                 │
  │ 请复制上述命令，确认无误后自行执行                        │
  └──────────────────────────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 6: 确认提交

```
┌──────────────────────────────────────────────────────────────┐
│ 🤔 确认提交？                                                │
│                                                              │
│    [Y] 是，我已执行 git commit                               │
│    [N] 还需要修改，回到走读                                  │
│    [E] 我想编辑提交信息                                      │
│    [S] 分拆成多个提交                                        │
└──────────────────────────────────────────────────────────────┘
```

**如果选择 S（分拆提交）：**

```
📦 分拆提交方案
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  提交 1: 【Feature】用户日志-添加 API 和类型定义
  • src/api/user.ts
  • src/api/types/user.ts

  提交 2: 【Feature】用户日志-添加 useUserLog hook
  • src/hooks/useUserLog.tsx

  提交 3: 【Feature】用户日志-添加表格组件
  • src/components/user/UserLogTable.vue

  提交 4: 【Feature】用户详情页-集成操作日志 Tab
  • src/views/user/detail.vue

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 完成输出

```
┌──────────────────────────────────────────────┐
│ ✅ 代码走读完成！                             │
│    代码已审阅，提交建议已生成                  │
└──────────────────────────────────────────────┘

📊 走读摘要
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  任务状态: 5/5 已完成
  审阅文件: 5 个
  优化建议: 3 条（采纳 2 条）

  提交建议:
    📝 【Feature】用户详情页-新增操作日志 Tab
    📝 已给出命令，请自行执行

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💬 接下来怎么做？

   方案 A：归档提案
   👉 输入: /admin:archive

   方案 B：还想再改改代码？
   👉 改完后重新运行: /admin:review

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⌨️ 快捷提示：输入 /admin 随时查看工作流全貌
```

---

## 参数

| 参数 | 描述 | 默认值 |
|------|------|--------|
| `--skip-review` | 跳过代码走读，直接生成提交建议 | false |
| `--auto` | 自动采纳所有优化建议 | false |

---

## 示例

```bash
# 完整走读流程（推荐）
/admin:review

# 跳过走读，直接生成提交建议
/admin:review --skip-review

# 自动采纳所有优化建议
/admin:review --auto
```

---

## 提交类型速查

| 类型 | 说明 | 示例 |
|------|------|------|
| 【Feature】 | 新功能 | 新增用户日志功能 |
| 【Bugfix】 | 修复 bug | 修复分页数据错误 |
| 【Optimize】 | 优化代码 | 优化日志查询性能 |
| 【Perf】 | 性能优化 | 减少不必要的 API 调用 |
| 【Test】 | 增加测试 | 添加日志组件单元测试 |
| 【Build】 | 构建工具变动 | 升级 vite 版本 |
| 【Revert】 | 撤销提交 | 撤销上一次错误提交 |
| 【Chore】 | 辅助工具变动 | 更新 lint 配置 |
| 【Docs】 | 文档改变 | 添加 API 注释 |
| 【Style】 | 样式改变 | 调整按钮样式 |

---

## 常见问题

```
🆘 遇到问题？

Q: 建议的优化我不认同怎么办？
A: 选择 N 跳过即可，走读建议都是可选的

Q: 走读时发现新问题怎么办？
A: 多轮迭代，修复后再走读一遍

Q: 改动涉及其他文件会怎样？
A: 不会！走读只针对本次改动的文件，绝不改动其他代码

Q: 能不能自动帮我提交？
A: 不能。系统只给建议，提交需要你确认后手动执行

Q: 提交信息不喜欢怎么办？
A: 选择 E 可以编辑提交信息
```
