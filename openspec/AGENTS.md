# AI 开发代理配置

> **项目**: ljb_ai_workflow_kit
> **版本**: 1.4.0
> **更新日期**: 2026-02-11

---

## 代理总览

| 代理 | 目录 | 使用阶段 | 职责 |
|------|------|----------|------|
| code-explorer | explore/ | START | 代码库探索和模式识别 |
| code-architect | design/ | DESIGN | 架构设计和方案对比 |
| impact-analyzer | audit/ | AUDIT | 影响范围分析、风险评估 |
| qa-arch-reviewer | audit/ | AUDIT | 架构质量审查 |
| qa-security-reviewer | audit/ | AUDIT | 安全漏洞审查 |
| code-reviewer | review/ | REVIEW | 代码质量审查 |
| code-simplifier | review/ | REVIEW | 增量代码简化 |

---

## 代理详情

### code-explorer

**目录**: `agents/explore/`

**职责**: 代码库探索和模式识别

**使用阶段**: START（Step 3 业务逻辑分析）

**并行数量**: 1-3（根据需求复杂度）

**在 START 阶段的作用**:
- Step 3 中负责分析现有代码，生成业务分析报告
- 定位入口文件、分析数据流向、识别架构模式
- 找出可复用的组件和参考实现

**输入**:
- PRD 文档（Step 1 生成）
- API 文档（Step 2 收集）
- 探索目标（类似功能/架构模式/组件使用）

**输出**:
- 业务分析报告（analysis.md）
- 可复用资源列表
- 架构模式识别结果

---

### code-architect

**目录**: `agents/design/`

**职责**: 架构设计和方案对比

**使用阶段**: DESIGN（含权限配置设计）

**并行数量**: 1-3（根据设计策略）

**核心原则**:
- **TSX + Vue 分离**: .tsx 负责 Model，.vue 负责 View
- **解构赋值**: Hook 返回值必须支持解构导出
- **组件复用**: 优先使用 pix-component

**设计策略**:
- **最小改动**: 只修改必要文件，最大化复用
- **务实平衡**: 适度改进结构，控制风险
- **清洁架构**: 优化整体架构，提升可维护性

**🆕 v1.4 权限配置设计**:
- 接口权限（API Permissions）
- 按钮权限（Button Permissions）
- 路由权限（Route Permissions）
- 菜单配置（Menu Configuration）

**输入**:
- PRD 文档
- 业务分析报告
- 设计策略

**输出**:
- 设计方案
- 文件变更清单
- 权限配置清单
- 风险评估

---

### impact-analyzer

**目录**: `agents/audit/`

**职责**: 影响范围分析、文件清单生成、风险评估

**使用阶段**: AUDIT

**并行数量**: 1

**分析维度**:
- **影响文件清单**: 按层级分类（API/视图/组件/逻辑/状态/工具/配置）
- **模块依赖图**: 文件间 import 关系、组件父子关系
- **风险评估**: 改动规模、影响范围、复杂度、回归风险

**输入**:
- 提案文档（proposal.md + tasks.md）
- 现有代码库

**输出**:
- 影响文件清单（分类展示）
- 模块依赖图（ASCII/Mermaid）
- 风险评估报告
- 提案可行性审查结果

---

### qa-arch-reviewer

**目录**: `agents/audit/`

**职责**: 架构质量审查

**使用阶段**: AUDIT

**并行数量**: 1

**审查重点**:
- 架构一致性
- 模块解耦程度
- 扩展性评估
- 技术债务识别

**输入**:
- 提案文档
- 现有架构

**输出**:
- 架构审查报告
- 改进建议

---

### qa-security-reviewer

**目录**: `agents/audit/`

**职责**: 安全漏洞审查

**使用阶段**: AUDIT

**并行数量**: 1

**审查重点**:
- XSS 防护
- CSRF 防护
- 权限校验
- 敏感数据处理
- 输入验证

**输入**:
- 提案文档
- 代码变更

**输出**:
- 安全审查报告
- 风险等级评估

---

### code-reviewer

**目录**: `agents/review/`

**职责**: 代码质量审查（结合 frontend-standards）

**使用阶段**: REVIEW

**并行数量**: 1

**审查重点**:
- **TSX + Vue 分离**: 检查逻辑是否正确抽离到 .tsx
- **解构赋值**: 检查 Hook 返回值是否使用解构
- **编译/语法错误**: 确保代码可正常编译
- **硬编码检查**: 识别应提取为常量/配置的值
- **注释规范**: 复杂逻辑需注释，简单逻辑不需要
- **样式质量**: 检查是否遵循 pix-component 规范

**注释判断标准**:
- 圈复杂度 > 5 → 需要注释
- 嵌套层级 > 3 → 需要注释
- 简单 CRUD / 类型定义 → 不需要注释

**范围限制**（重要）:
- ✅ 仅审查本次任务改动的文件
- ❌ 不审查未改动的文件

**输入**:
- 本次任务改动的文件清单
- frontend-standards 规范

**输出**:
- 审查报告（通过项/需改进项/信息项）
- 自动修复建议（可选）

---

### code-simplifier

**目录**: `agents/review/`

**职责**: 增量代码简化（仅针对本次改动）

**使用阶段**: REVIEW

**并行数量**: 1

**简化原则**:
- KISS: 保持简单
- DRY: 消除重复
- YAGNI: 删除未使用代码

**范围限制**（重要）:
- ✅ 仅分析本次任务改动的文件
- ❌ 不修改与本次需求无直接关联的代码
- ❌ 不进行全局重构

**输入**:
- 本次任务改动的文件清单
- 项目规范

**输出**:
- 简化建议列表（需用户确认）
- 预计改动范围
- 简化后的代码（用户确认后应用）

**执行流程**:
1. 分析本次改动的文件
2. 生成简化建议
3. 展示给用户确认
4. 用户可选择性接受或跳过

---

## 代理协同流程（7阶段精简版）

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🤖 多代理协同架构 v1.4                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  🎬 INIT 阶段                                                       │
│  └── 项目初始化（检测技术栈，生成配置）                              │
│           ↓                                                         │
│  📋 START 阶段（引导式收集 · 智能获取）                              │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Step 1: Jira 需求获取                                       │   │
│  │         • 引导配置凭证（站点/邮箱/令牌）                     │   │
│  │         • curl 直接拉取需求 + 引导性问题                     │   │
│  │                          ↓                                   │   │
│  │ Step 2: API 文档收集（可选，用于字段优化）                   │   │
│  │         • 默认: 🤖 智能获取 - AI 自动点击 Apifox 按钮        │   │
│  │         • 备选: 📋 手动提供 - 复制/截图/描述                 │   │
│  │         • 可跳过，后续补充                                   │   │
│  │                          ↓                                   │   │
│  │ Step 3: 业务上下文分析 🔄                                    │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │   │
│  │  │code-explorer│  │code-explorer│  │code-explorer│         │   │
│  │  │  入口定位   │  │  数据流向   │  │  可复用资源 │         │   │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘         │   │
│  │         └────────────────┼────────────────┘                 │   │
│  │                          ↓ analysis.md                       │   │
│  │ Step 4: 复杂度评估                                           │   │
│  │         • 综合 Jira + API + 业务分析                         │   │
│  │         • 界定难易程度 → 推荐 DESIGN 策略                    │   │
│  │         • 生成 OpenSpec proposal.md                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                          ↓                                          │
│  🎨 DESIGN 阶段（含权限配置）                                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │
│  │code-architect│ │code-architect│ │code-architect│                │
│  │  最小改动   │  │  务实平衡   │  │  清洁架构   │                │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                │
│         └────────────────┼────────────────┘                        │
│                          ↓                                          │
│  📑 AUDIT 阶段（多轮迭代）                                          │
│  ┌────────────────┐  ┌──────────────────┐  ┌────────────────────┐ │
│  │ impact-analyzer│  │ qa-arch-reviewer │  │qa-security-reviewer│ │
│  │   影响分析    │  │   架构审查      │  │    安全审查       │ │
│  └───────┬────────┘  └────────┬─────────┘  └─────────┬──────────┘ │
│          └───────────────────┼──────────────────────┘              │
│                              ↓                                      │
│  ⚡ APPLY 阶段                                                      │
│  └── 逐任务确认执行（可暂停 + 选择性回滚）                          │
│                              ↓                                      │
│  🔍 REVIEW 阶段（多轮迭代）                                         │
│  ┌────────────────┐  ┌────────────────┐                            │
│  │  code-reviewer │  │ code-simplifier│                            │
│  │   代码审查    │  │   代码简化    │                            │
│  └───────┬────────┘  └───────┬────────┘                            │
│          └───────────────────┘                                      │
│                              ↓                                      │
│  📦 ARCHIVE 阶段                                                    │
│  └── 提案归档 + 更新索引                                            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 配置示例

```json
{
  "agents": {
    "code-explorer": {
      "count": 2,
      "model": "sonnet"
    },
    "code-architect": {
      "count": 2,
      "model": "opus",
      "strategies": ["minimal", "balanced"],
      "enforceTsxVueSeparation": true,
      "includePermissionDesign": true
    },
    "impact-analyzer": {
      "enabled": true,
      "model": "sonnet",
      "includeDependencyGraph": true,
      "includeRiskAssessment": true
    },
    "qa-arch-reviewer": {
      "enabled": true,
      "model": "sonnet"
    },
    "qa-security-reviewer": {
      "enabled": true,
      "model": "sonnet"
    },
    "code-reviewer": {
      "enabled": true,
      "model": "sonnet",
      "checkTsxVueSeparation": true,
      "checkDestructuring": true,
      "checkHardcode": true,
      "checkComments": true,
      "useFrontendStandards": true
    },
    "code-simplifier": {
      "enabled": true,
      "model": "sonnet"
    }
  }
}
```

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.4.0 | 2026-02-11 | 7阶段精简版，新增 qa-arch-reviewer/qa-security-reviewer，删除 api-parser（整合到 START） |
| v1.1.0 | 2026-02-11 | 初始版本 |
